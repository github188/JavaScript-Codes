<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>07列表频道直播</title>
<style>
	.t1{
		background:url(dlist_bg.png) no-repeat center;
	}
	.t2{
		background:url(dlist_bg_focus.png) no-repeat center;
		color:#fff;
	}
</style>
</head>

<body background="bg2.jpg" topmargin="0" leftmargin="0">
	<div style="position:absolute;left:0px;top:0px; width:1050px; height:720px; background:url(cover02.png);">
		<!--箭头-->
		<div style="position:absolute;left:28px;top:306px; width:40px; height:40px;"><img src="arrow_left.png" width="36" height="39"></div>
		<div style="position:absolute;left:73px;top:46px; width:172px; height:546px;">
			<table border="0" cellpadding="0" cellspacing="0" width="172" height="546" style="position:absolute;left:0px;font-size:24px;color:#727374; text-align:center;">
				<tr id='dlist0' height="78">
					<td></td>
				</tr>
				<tr id='dlist1' height="78"><td></td></tr>
				<tr id='dlist2' height="78"><td></td></tr>
				<tr id='dlist3' height="78"><td></td></tr>
				<tr id='dlist4' height="78"><td></td></tr>
				<tr id='dlist5' height="78"><td></td></tr>
				<tr id='dlist6' height="78"><td></td></tr>
				<tr id='dlist7' height="78"><td></td></tr>
			</table>
		</div>
		
		<div style="position:absolute;left:292px;top:46px; width:308px; height:624px;">
			<div style="position:absolute;top:78px; width:307px; height:1px; background:url(line02.png);"></div>
			<div style="position:absolute;top:156px; width:307px; height:1px; background:url(line02.png);"></div>
			<div style="position:absolute;top:234px; width:307px; height:1px; background:url(line02.png);"></div>
			<div style="position:absolute;top:312px; width:307px; height:1px; background:url(line02.png);"></div>
			<div style="position:absolute;top:390px; width:307px; height:1px; background:url(line02.png);"></div>
			<div style="position:absolute;top:468px; width:307px; height:1px; background:url(line02.png);"></div>
			<div style="position:absolute;top:546px; width:307px; height:1px; background:url(line02.png);"></div>
			<div id="plist_focus" style="position:absolute;left:-52px;top:-16px; width:400px; height:113px; background:url(list_focus.png);visibility:hidden;">
				<div style="position:absolute;left:315px;top:33px; width:55px; height:47px; background:url(icon_play.png);"></div>
			</div>
			
			<table border="0" cellpadding="0" cellspacing="0" width="308" height="624" style="position:absolute;left:0px;font-size:24px;color:#a0a2a4;">
				<tr id=plist0 height="78">
					<td width="85" align="center"></td>
					<td width="221"></td>
				</tr>
				<tr id=plist1 height="78">
					<td width="85" align="center"></td>
					<td width="221"></td>
				</tr>
				<tr id=plist2 height="78">
					<td width="85" align="center"></td>
					<td width="221"></td>
				</tr>
				<tr id=plist3 height="78">
					<td width="85" align="center"></td>
					<td width="221"></td>
				</tr>
				<tr id=plist4 height="78">
					<td width="85" align="center"></td>
					<td width="221"></td>
				</tr>
				<tr id=plist5 height="78">
					<td width="85" align="center"></td>
					<td width="221"></td>
				</tr>
				<tr id=plist6 height="78">
					<td width="85" align="center"></td>
					<td width="221"></td>
				</tr>
				<tr id=plist7 height="78">
					<td width="85" align="center"></td>
					<td width="221"></td>
				</tr>
			</table>
		</div>
		
	</div>


	<script src="../scripts/ui_pageData.js"></script>
	<script>
		
	var tvodData = 



	window.document.onkeydown = eventHandler;


	function eventHandler( e ) {
		
		var keycode = e.which ? e.which : e.keycode;

		switch ( keycode ) {

			case 38:
				keyUp();;
				return false;
				break;
			case 40:
				keyDown();
				return false;
				break;
			case 37:
				keyLeft();
				return false;
				break;
			case 39:
				keyRight();
				return false;
				break;
			default:
				return true;
				break;
		}
	}

	var area 		= 0,
		dateFocus 	= 0,
		progFocus 	= 0,
		dateLines 	= 8,
		progLines 	= 8,
		lines 		= 8,
		focusTop 	= -16,
		progDatas = null,
		dateDatas = null;

	function keyUp() {
		
		if ( area === 0 ) { // date

			changeDateList( -1 );
		} else if ( area === 1 ) {

			changeProgList( -1 );
		}
	}

	function keyDown() {
		
		if ( area === 0 ) {

			changeDateList( 1 );
		} else if ( area === 1 ) {

			changeProgList( 1 );
		}
	}

	function keyLeft() {

		if ( area === 1 ) {

			area = 0;

			progListLoseFocus( progFocus );

			progFocus = 0;

		} else if ( area === 0 ) {

			return;
		}	
	}

	function keyRight() {
		
		if ( area === 0 ) {

			area = 1;

			progListGetFocus( progFocus );

		} else if ( area === 1 ) {

			return;
		}
	}

	function changeDateList( direction ) {
		
		var line = lines;

		if ( direction !== -1 && direction !== 1 ) {

			return false;
		}

		if ( dateLines < lines ) {

			line = dateLines;
		}

		dateListLoseFocus( dateFocus );

		dateFocus = direction > 0 ? dateFocus + 1 : dateFocus - 1;

		if ( dateFocus < 0 ) {

			dateFocus = 0;
		} else if ( dateFocus >= line ) {

			dateFocus = line - 1;
		}

		// 刷新节目列表数据
		// updateProgList( date );

		dateListGetFocus( dateFocus );
	}

	function dateListGetFocus( index ) {
		
		var id = 'dlist' + index;

		$( id ).className = 't2';
		$( id ).style.background = 'url(dlist_bg_focus.png) no-repeat center';
		$( id ).style.color = '#FFFFFF';
	}

	function dateListLoseFocus( index ) {

		var id = 'dlist' + index;

		$( id ).className = 't1';
		$( id ).style.background = '';
		$( id ).style.color = '#727374';
	}

	function changeProgList( direction ) {
		
		var line = lines;

		if ( direction !== -1 && direction !== 1 ) {

			return false;
		} 

		if ( progLines < lines ) {

			line = progLines;
		}

		progListLoseFocus( progFocus );

		progFocus = direction > 0 ? progFocus + 1 : progFocus - 1;

		if ( progFocus < 0 ) {

			progFocus = 0;
		} else if ( progFocus >= line ) {

			progFocus = line - 1;
		}

		progListGetFocus();
	}

	function progListGetFocus( direction ) {

		var id 		= 'plist_focus',
			top 	= 0,
			trH 	= 78;

		console.log( direction + ', ' + progFocus );

		$( 'plist' + progFocus ).style.color = '#ffffff';

		$( id ).style.visibility = 'visible';

		$( id ).style.top = ( focusTop + trH * progFocus ) + 'px';
	}

	function progListLoseFocus( index ) {
		
		$( 'plist' + progFocus ).style.color = '#a0a2a4';

		$( 'plist_focus' ).style.visibility = 'hidden';

		// no need
	}

	// 从tvod中获取日期和节目数据
	function getFromTvodData( name ) {

	    var tvodData    = null,
	        data        = null,
	        result      = [],
	        i = 0, len  = 0;

	    if ( typeof name !== 'string' || name === '' ) {

	        debug( 'get data from tvod error' );
	        return null;
	    }

	    tvodData = tvodListData;

	    len = tvodData.length;

	    for ( ; i < len; i++ ) {

	        data = tvodData[i];

	        if ( data.hasOwnProperty( name ) ) {

	            result.push( data[ name ] );
	        } else {

	            debug( 'get data from tvod error: attr not found' );
	        }
	    }

	    return result;
	};

	function showData() {
		
		var i = 0,
			dateLen = 0,
			progLen = 0,
			tds = null,
			td = null,
			tr = null;


		dateLen = dateDatas.length;

		prog 	= progDatas[ dateFocus ];
		progLen = prog.length;

		for ( ; i < lines; i++ ) {

			// dates
			tr =  $( 'dlist' + i );
			td = tr.getElementsByTagName( 'td' )[0];
			if ( i < dateLines ) {

				td.innerText = dateDatas[i];

				tr.className = 't1';
			}

			// programs time
			tds = $( 'plist' + i ).getElementsByTagName( 'td' );
			if ( i < progLines ) {

				tds[0].innerText = prog[i].time;
				tds[1].innerText = prog[i].name;
			}
		}
	}

	function dataInit() {
		
		var prog = null;

		dateDatas = getFromTvodData( 'date' );
		progDatas = getFromTvodData( 'prog' );

		dateLines = dateDatas.length;

		prog = progDatas[ dateFocus ];
		progLines = prog.length;

	}
	
	function init() {
		
		dataInit();

		showData();

		dateListGetFocus( 0 );
	}


	function $( id ) {
		
		return document.getElementById( id );
	}

	function debug( str ) {
		
		console.log( str );
	}

	window.onload = init;

	</script>

</body>
</html>
